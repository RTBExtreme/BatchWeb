window.addEventListener("DOMContentLoaded",()=>{let echoEnabled=!0,envVars={PATH:"C:\\Windows\\System32;C:\\Windows",USERNAME:"BatchWeb",COMPUTERNAME:"BATCHWEB-PC"};const BatchWebConsole=document.createElement("div");BatchWebConsole.style.background="#000",BatchWebConsole.style.color="#fff",BatchWebConsole.style.padding="10px",BatchWebConsole.style.fontFamily="Consolas, monospace",BatchWebConsole.style.height="100vh",BatchWebConsole.style.overflowY="auto",BatchWebConsole.style.whiteSpace="pre-wrap",document.body.style.margin="0",document.body.appendChild(BatchWebConsole);const inputLine=document.createElement("div");BatchWebConsole.appendChild(inputLine);let isWaitingTimeout=!1,timeoutResolve=null,batchScriptLines=[],labelsMap={},currentLineIndex=0,runningBatch=!1,commandRunning=!1,lastCommand="",cancelRequested=!1;function print(e=""){const t=document.createElement("div");t.textContent=e,t.style.color=BatchWebConsole.style.color,BatchWebConsole.insertBefore(t,inputLine),BatchWebConsole.scrollTop=BatchWebConsole.scrollHeight}function addPrompt(e=""){inputLine.innerHTML="";const t=document.createElement("span");t.textContent="C:\\> ",t.style.color=BatchWebConsole.style.color;const n=document.createElement("input");n.type="text",n.style.background="black",n.style.color=BatchWebConsole.style.color,n.style.border="none",n.style.outline="none",n.style.font="inherit",n.style.width="90%",n.value=e,inputLine.appendChild(t),inputLine.appendChild(n),n.focus(),n.setSelectionRange(n.value.length,n.value.length),n.addEventListener("keydown",async e=>{if("ArrowUp"===e.key)return e.preventDefault(),lastCommand&&(n.value=lastCommand),void n.setSelectionRange(n.value.length,n.value.length);if(isWaitingTimeout)"Enter"===e.key?(timeoutResolve&&(timeoutResolve(),timeoutResolve=null),e.preventDefault()):"c"===e.key&&e.ctrlKey?(timeoutResolve&&(cancelRequested=!0,timeoutResolve(),timeoutResolve=null),e.preventDefault()):e.preventDefault();else if("c"===e.key&&e.ctrlKey)commandRunning&&(cancelRequested=!0,e.preventDefault());else if("Enter"===e.key){if(commandRunning)return;commandRunning=!0,cancelRequested=!1;const e=n.value.trim();lastCommand=e,await executeCommand(e),commandRunning=!1}})}function expandVariables(e){return e.replace(/%([^%]+)%/g,(e,t)=>envVars[t.toUpperCase()]??"")}function hexDigitToColor(e){return{0:"#000000",1:"#0000AA",2:"#00AA00",3:"#00AAAA",4:"#AA0000",5:"#AA00AA",6:"#AAAA00",7:"#AAAAAA",8:"#555555",9:"#FFFFFF"}[e]||null}function applyColorCommand(e){if(!e)return"Usage: color [fg] or [bg][fg] where fg,bg are 0-9";if(1===e.length){if(!/[0-9]/.test(e))return"Invalid color code";const t=hexDigitToColor(e);return t?void(BatchWebConsole.style.color=t):"Invalid color code"}if(2===e.length){const t=e[0],n=e[1];if(!/[0-9]/.test(t)||!/[0-9]/.test(n))return"Invalid color codes";const o=hexDigitToColor(n),i=hexDigitToColor(t);return o&&i?(BatchWebConsole.style.color=o,void(BatchWebConsole.style.background=i)):"Invalid color codes"}return"Usage: color [fg] or [bg][fg]"}async function setPInput(e,t){isWaitingTimeout=!0,inputLine.innerHTML="";const n=document.createElement("span");n.textContent=t,n.style.color=BatchWebConsole.style.color;const o=document.createElement("input");return o.type="text",o.style.background="black",o.style.color=BatchWebConsole.style.color,o.style.border="none",o.style.outline="none",o.style.font="inherit",o.style.width="90%",inputLine.appendChild(n),inputLine.appendChild(o),o.focus(),cancelRequested=!1,new Promise(t=>{const n=i=>{if(cancelRequested)return envVars[e.toUpperCase()]="",print("^C"),isWaitingTimeout=!1,inputLine.innerHTML="",window.removeEventListener("keydown",n),t(),void(runningBatch||addPrompt());"Enter"===i.key&&(envVars[e.toUpperCase()]=o.value,print(`${e}=${o.value}`),isWaitingTimeout=!1,inputLine.innerHTML="",window.removeEventListener("keydown",n),t(),runningBatch||addPrompt())};window.addEventListener("keydown",n)})}async function executeCommand(e){if(cancelRequested)return print("^C"),void(runningBatch||addPrompt());if(!e)return void(runningBatch||addPrompt());if(e.startsWith("::")||/^rem /i.test(e))return void(runningBatch||addPrompt());let t=expandVariables(e);const n=t.toLowerCase();if("@echo off"===n)return echoEnabled=!1,void(runningBatch||addPrompt());if("@echo on"===n)return echoEnabled=!0,void(runningBatch||addPrompt());if(echoEnabled&&!runningBatch&&print(`C:\\> ${e}`),cancelRequested)return print("^C"),void(runningBatch||addPrompt());const o=t.match(/(?:[^\s"]+|"[^"]*")+/g)||[];if(0===o.length)return void(runningBatch||addPrompt());const i=o[0].toLowerCase(),r=o.slice(1).map(e=>e.replace(/^"(.*)"$/,"$1"));if(cancelRequested)return print("^C"),void(runningBatch||addPrompt());if("goto"===i){const e=r[0];if(!e)return print("goto command requires a label"),void(runningBatch||addPrompt());const t=labelsMap[e.toLowerCase()];return void 0===t?(print(`Label not found: ${e}`),void(runningBatch||addPrompt())):void(currentLineIndex=t)}if("set"===i&&"/p"===r[0]){const e=t.match(/^set\s+\/p\s+([a-zA-Z_][a-zA-Z0-9_]*)=(.*)$/i);if(!e)return print("Usage: set /p VAR=PromptText"),void(runningBatch||addPrompt());const n=e[1],o=e[2];return await setPInput(n,o),void(cancelRequested&&(print("^C"),cancelRequested=!1))}if("pause"===i)return print("Press any key to continue . . ."),cancelRequested=!1,await new Promise(e=>{const t=n=>{if(cancelRequested)return print("^C"),cancelRequested=!1,window.removeEventListener("keydown",t),void e();window.removeEventListener("keydown",t),e()};window.addEventListener("keydown",t)}),void(runningBatch||addPrompt());if("timeout"===i){const e=Number(r[0]);return isNaN(e)||e<0?(print("Usage: timeout [seconds]"),void(runningBatch||addPrompt())):(print(`Waiting for ${e} seconds... (Press Enter to skip, Ctrl+C to cancel)`),isWaitingTimeout=!0,cancelRequested=!1,await new Promise(t=>{timeoutResolve=t;const n=setTimeout(()=>{timeoutResolve&&(timeoutResolve(),timeoutResolve=null)},1e3*e);window.addEventListener("keydown",e=>{"Enter"===e.key&&timeoutResolve&&(clearTimeout(n),timeoutResolve(),timeoutResolve=null),"c"===e.key&&e.ctrlKey&&(cancelRequested=!0,timeoutResolve&&(clearTimeout(n),timeoutResolve(),timeoutResolve=null))},{once:!0})}),isWaitingTimeout=!1,cancelRequested?(print("^C"),cancelRequested=!1):print("Timeout ended."),void(runningBatch||addPrompt()))}if(cancelRequested)return print("^C"),void(runningBatch||addPrompt());if("function"==typeof window.commands[i])try{const e=await window.commands[i](...r);if(cancelRequested)return print("^C"),cancelRequested=!1,void(runningBatch||addPrompt());void 0!==e&&""!==e&&print(String(e))}catch(e){print("Error: "+e.message)}else print(`'${i}' is not recognized as an internal or external command.`);runningBatch||addPrompt()}async function runBatchScript(e){batchScriptLines=e.split(/\r?\n/),labelsMap={};for(let e=0;e<batchScriptLines.length;e++){const t=batchScriptLines[e].trim();if(t.startsWith(":")){const n=t.slice(1).toLowerCase();labelsMap[n]=e+1}}for(runningBatch=!0,currentLineIndex=0,cancelRequested=!1;currentLineIndex<batchScriptLines.length;){if(cancelRequested){print("^C"),cancelRequested=!1;break}let e=batchScriptLines[currentLineIndex].trim();if(!e||e.startsWith("::")||/^rem /i.test(e)||e.startsWith(":")){currentLineIndex++;continue}const t=currentLineIndex;if(await executeCommand(e),await new Promise(e=>setTimeout(e,200)),cancelRequested){print("^C"),cancelRequested=!1;break}currentLineIndex===t&&currentLineIndex++}runningBatch=!1,addPrompt()}window.commands={help:()=>"Supported commands:\necho [text]         - Display text\ncolor [fg] or [bg][fg] - Set text and background color (0-9)\ncls                 - Clear the screen\nver                 - Show version info\ndate                - Show current date\ntime                - Show current time\nping [host]         - Simulate ping command\nwhoami              - Show current user\nset [VAR=VALUE]     - Set environment variable\nset /p VAR=Prompt   - Prompt input and assign to VAR\nset                  - List environment variables\nexit                - Clear screen and end session\ngreet [name] [time] - Custom greet command\ntitle [text]        - Set window/tab title\nhostname            - Show computer name\ntasklist            - Show running tasks (simulated)\nsysteminfo          - Show system info (simulated)\nnetstat             - Show network connections (simulated)\nipconfig            - Show IP config (simulated)\npath                - Show PATH environment variable\npause               - Wait for key press\ncurl [url]          - Fetch URL and print text content\ndownload [url]      - Download file from URL\njs [code]           - Evaluate JS code\nmsg * [message]     - Popup message box\ntimeout [seconds]   - Wait for specified seconds (can press Enter to skip, Ctrl+C to cancel)\nupload-bat          - Upload and run batch script file",echo:(...e)=>e.join(" "),cls:()=>{BatchWebConsole.innerHTML="",BatchWebConsole.appendChild(inputLine)},ver:()=>"Microsoft Windows [Version 10.0.19045.2965]",date:()=>(new Date).toLocaleDateString(),time:()=>(new Date).toLocaleTimeString(),ping:async e=>{if(!e)return"Ping usage: ping [host]";print(`Pinging ${e} with 32 bytes of data:`);for(let t=0;t<4&&!cancelRequested&&(await new Promise(e=>setTimeout(e,500)),!cancelRequested);t++)print(`Reply from ${e}: bytes=32 time=${Math.floor(100*Math.random())}ms TTL=128`);return cancelRequested?"^C":`Ping statistics for ${e}:\n    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),\nApproximate round trip times in milli-seconds:\n    Minimum = 0ms, Maximum = 100ms, Average = 50ms`},whoami:()=>envVars.USERNAME,set:(...e)=>{if(0===e.length){let e=[];for(const t in envVars)e.push(`${t}=${envVars[t]}`);return e.join("\n")}const t=e.join(" ").split("=");if(2!==t.length)return"Usage: set VAR=VALUE";const n=t[0].toUpperCase(),o=t[1];envVars[n]=o},exit:()=>{BatchWebConsole.innerHTML="",BatchWebConsole.appendChild(inputLine)},greet:(e="user",t="day")=>`Good ${t}, ${e}!`,title:(e="")=>{document.title=e},hostname:()=>envVars.COMPUTERNAME,tasklist:()=>"Image Name                     PID Session Name        Session#    Mem Usage\nSystem Idle Process              0 Services                   0         24 K\nSystem                           4 Services                   0        224 K\nsmss.exe                       388 Services                   0        492 K\nexplorer.exe                  2284 Console                    1      15,280 K\ncmd.exe                      4520 Console                    1       1,020 K\n",systeminfo:()=>`Host Name: ${envVars.COMPUTERNAME}\nOS Name: Microsoft Windows 10 Pro\nOS Version: 10.0.19045 Build 19045\nSystem Manufacturer: Generic\nSystem Model: Emulator PC\nProcessor(s): 1 Processor(s) Installed.\nTotal Physical Memory: 8 GB`,netstat:()=>"Active Connections\n\n  Proto  Local Address          Foreign Address        State\n  TCP    127.0.0.1:80           0.0.0.0:0              LISTENING\n  TCP    192.168.0.101:139      0.0.0.0:0              LISTENING",ipconfig:()=>"Windows IP Configuration\n\nEthernet adapter Ethernet:\n\n   Connection-specific DNS Suffix  . : localdomain\n   IPv4 Address. . . . . . . . . . . : 192.168.0.101\n   Subnet Mask . . . . . . . . . . . : 255.255.255.0\n   Default Gateway . . . . . . . . . : 192.168.0.1",path:()=>envVars.PATH,curl:async e=>{if(!e)return"Usage: curl [url]";try{let t=await fetch(e);return(await t.text()).slice(0,2e3)}catch{return"Error: Failed to fetch URL"}},download:async e=>{if(!e)return"Usage: download [url]";try{let t=await fetch(e);if(!t.ok)return"Download failed";let n=await t.blob(),o=document.createElement("a");o.href=URL.createObjectURL(n);let i=e.split("/");return o.download=i[i.length-1]||"download",o.click(),`Downloaded ${o.download}`}catch{return"Error: Download failed"}},js:code=>{try{let result=eval(code);return void 0===result?"":String(result)}catch(e){return"JS Error: "+e.message}},msg:(...e)=>{const t=e.slice(1).join(" ");alert(t)},"upload-bat":()=>{const e=document.createElement("input");e.type="file",e.accept=".bat,.cmd",e.onchange=()=>{const t=e.files[0];if(!t)return;const n=new FileReader;n.onload=e=>{runBatchScript(e.target.result)},n.readAsText(t)},e.click()}},print("Microsoft Windows [Version 10.0.19045.2965]"),print("Running under BatchWeb Environment (v1.0)"),addPrompt()});